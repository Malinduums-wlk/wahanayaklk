{% extends 'base.html' %}
{% load static %}

{% block title %}Shop Setup - Vehicle Ads{% endblock %}

{% block extra_css %}
<style>
    .cover-upload {
        position: relative;
        width: 100%;
        padding-top: 50%; /* 4:2 aspect ratio container */
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
    }

    .cover-upload .upload-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

    /* Removed hover effect for cover overlay */

    .cover-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .cover-upload input[type='file'] {
        opacity: 0;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .cover-upload img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
    .form-section {
        margin-bottom: 2rem;
    }
    .form-section h5 {
        margin-bottom: 1rem;
        color: #333;
    }
    .social-link-input {
        position: relative;
    }
    .social-link-input i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
    }
    .social-link-input input {
        padding-left: 35px !important;
    }
    .remove-cover-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(220, 53, 69, 0.9);
        color: #fff;
        border: 2px solid #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .remove-cover-btn:hover {
        background: rgba(220, 53, 69, 1);
    }
    .edit-mode .remove-cover-btn {
        display: flex !important;
        opacity: 0.9;
    }
    
    /* Show recycle bin when hovering over cover in edit mode */
    .edit-mode .cover-upload:hover .remove-cover-btn {
        opacity: 1;
    }
    
    /* Always show recycle bin in edit mode */
    .edit-mode .remove-cover-btn {
        opacity: 1 !important;
    }
    
    /* Disable ALL hover effects on the shop setup page */
    .card,
    .card *,
    .container,
    .container *,
    .form-section,
    .form-section *,
    .cover-upload,
    .cover-upload * {
        transition: none !important;
    }
    
    .card:hover,
    .card:hover *,
    .container:hover,
    .container:hover *,
    .form-section:hover,
    .form-section:hover *,
    .cover-upload:hover,
    .cover-upload:hover * {
        transform: none !important;
        box-shadow: none !important;
        opacity: inherit !important;
    }
    
    /* Disable any Bootstrap hover effects */
    .btn:hover,
    .btn:focus {
        transform: none !important;
        box-shadow: none !important;
    }
    
    /* Disable Bootstrap shadow classes */
    .shadow,
    .shadow-sm,
    .shadow-lg,
    .shadow-none {
        box-shadow: none !important;
    }
    
    /* Remove drop shadow from shop setup section completely */
    .card {
        box-shadow: none !important;
    }
    
    /* Fix divider line opacity to 20% and prevent hover changes */
    hr {
        opacity: 0.2 !important;
    }
    
    .form-fields {
        display: none;
    }
    .edit-mode .form-fields {
        display: block;
    }
    .read-only-text {
        display: block;
    }
    .edit-mode .read-only-text {
        display: none;
    }
    .form-label {
        font-weight: 500;
        color: #333;
    }
    .action-buttons {
        display: none !important;
    }
    .edit-mode .action-buttons {
        display: flex !important;
    }
    
    /* Hide any form validation messages or text that might appear */
    .form-section .help-text,
    .form-section .errorlist,
    .form-section .invalid-feedback {
        display: none !important;
    }
    
    /* Hide any Django form errors that might appear */
    .alert,
    .alert-danger,
    .alert-warning {
        display: none !important;
    }
    
    /* Hide Django messages on shop setup page */
    .container .alert {
        display: none !important;
    }
    
    /* Hide Django file input default text */
    .cover-upload input[type="file"] ~ * {
        display: none !important;
    }
    
    /* Hide Django's ClearableFileInput text and any sibling elements */
    .cover-upload .clearable-file-input,
    .cover-upload .clearable-file-input *,
    .cover-upload input[type="file"] + *,
    .cover-upload input[type="file"] + label,
    .cover-upload input[type="file"] + span,
    .cover-upload input[type="file"] + div,
    .cover-upload input[type="file"] + p,
    .cover-upload input[type="file"] + strong,
    .cover-upload input[type="file"] + em,
    .cover-upload input[type="file"] + b,
    .cover-upload input[type="file"] + i,
    .cover-upload input[type="file"] + u,
    .cover-upload input[type="file"] + s,
    .cover-upload input[type="file"] + code,
    .cover-upload input[type="file"] + pre,
    .cover-upload input[type="file"] + blockquote,
    .cover-upload input[type="file"] + ul,
    .cover-upload input[type="file"] + ol,
    .cover-upload input[type="file"] + li,
    .cover-upload input[type="file"] + dl,
    .cover-upload input[type="file"] + dt,
    .cover-upload input[type="file"] + dd,
    .cover-upload input[type="file"] + table,
    .cover-upload input[type="file"] + tr,
    .cover-upload input[type="file"] + td,
    .cover-upload input[type="file"] + th,
    .cover-upload input[type="file"] + thead,
    .cover-upload input[type="file"] + tbody,
    .cover-upload input[type="file"] + tfoot,
    .cover-upload input[type="file"] + caption,
    .cover-upload input[type="file"] + colgroup,
    .cover-upload input[type="file"] + col,
    .cover-upload input[type="file"] + fieldset,
    .cover-upload input[type="file"] + legend,
    .cover-upload input[type="file"] + input,
    .cover-upload input[type="file"] + button,
    .cover-upload input[type="file"] + select,
    .cover-upload input[type="file"] + textarea,
    .cover-upload input[type="file"] + form,
    .cover-upload input[type="file"] + iframe,
    .cover-upload input[type="file"] + object,
    .cover-upload input[type="file"] + embed,
    .cover-upload input[type="file"] + param,
    .cover-upload input[type="file"] + applet,
    .cover-upload input[type="file"] + map,
    .cover-upload input[type="file"] + area,
    .cover-upload input[type="file"] + base,
    .cover-upload input[type="file"] + link,
    .cover-upload input[type="file"] + meta,
    .cover-upload input[type="file"] + script,
    .cover-upload input[type="file"] + style,
    .cover-upload input[type="file"] + title,
    .cover-upload input[type="file"] + head,
    .cover-upload input[type="file"] + body,
    .cover-upload input[type="file"] + html {
        display: none !important;
    }
    .edit-mode .edit-mode-only { 
        display: flex !important; 
    }
    .edit-mode-only { 
        display: none !important; 
    }
    
    /* Ensure upload content is hidden in read-only mode */
    .upload-content.edit-mode-only {
        display: none !important;
    }
    .edit-mode .upload-content.edit-mode-only {
        display: flex !important;
    }
    /* Account sidebar styles */
    .account-sidebar {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 1.5rem;
        height: fit-content;
    }

    .account-sidebar h5 {
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #333;
    }

    .account-sidebar .btn {
        margin-bottom: 0.5rem;
        text-align: left;
        justify-content: flex-start;
        border: none;
        background: transparent;
        color: #666;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .account-sidebar .btn:hover {
        background: #e9ecef;
        color: #333;
    }
    
    .account-sidebar .btn.active {
        background: #4361ee;
        color: white;
    }

    .account-sidebar .btn.active:hover {
        background: #3451d1;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5" style="max-width: 1200px;">
    <div class="row">
        <div class="col-md-3 mb-4">
            <div class="account-sidebar">
                <h5>Account Settings</h5>
                <div class="d-flex flex-column">
                    <a href="{% url 'users:profile' %}" class="btn">Profile</a>
                    {% if profile.is_premium %}
                    <a href="{% url 'users:shop_setup' %}" class="btn active">Shop</a>
                    {% endif %}
                    <a href="{% url 'users:my_ads' %}" class="btn">My Ads</a>
                    <a href="{% url 'users:my_favorites' %}" class="btn">My Favorites</a>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="card p-4" style="border-radius: 1rem;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold mb-0">Shop Setup</h2>
                    <a href="#" class="edit-profile-btn" id="editShopBtn">
                        <i class="fas fa-pen"></i>
                        <span>Edit Shop</span>
                    </a>
                </div>
                <hr>
                <form method="post" enctype="multipart/form-data" id="shopForm">
                    {% csrf_token %}
                    <!-- Cover Photo -->
                    <div class="form-section">
                        <h5>Cover Page</h5>
                        <div class="cover-upload" style="position: relative;">
                            <label for="id_cover_photo" style="width: 100%; height: 100%; display: block; cursor: pointer;">
                                {% if shop and shop.cover_photo %}
                                    <img src="{{ shop.cover_photo.url }}" alt="Cover Photo" id="cover-preview">
                                {% else %}
                                    <div class="upload-content edit-mode-only" id="cover-placeholder">
                                        <i class="fas fa-plus-circle mb-2" style="font-size: 3rem; color: #cbd5e1;"></i>
                                        <p class="text-muted mb-0">Click to upload cover photo</p>
                                    </div>
                                    <img src="" alt="Cover Photo" id="cover-preview" style="display: none;">
                                {% endif %}
                                {{ form.cover_photo }}
                                <input type="hidden" name="remove_cover" id="removeCoverInput" value="0">
                            </label>
                            {% if shop and shop.cover_photo %}
                            <button type="button" class="remove-cover-btn" id="removeCoverBtn" title="Remove cover photo">
                                <i class="fas fa-trash" style="font-size: 16px;"></i>
                            </button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Read-only display -->
                    <div class="read-only-text">
                        <div class="form-section">
                            <h5>Company</h5>
                            <div class="info-row">
                                <span class="info-label">Company Name:</span>
                                <span class="info-value">{{ shop.company_name }}</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Contact</h5>
                            <div class="info-row">
                                <span class="info-label">Primary Contact:</span>
                                <span class="info-value">{{ shop.contact_number1 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Secondary Contact:</span>
                                <span class="info-value">{{ shop.contact_number2 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">WhatsApp Contact:</span>
                                <span class="info-value">{{ shop.whatsapp_number }}</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Location</h5>
                            <div class="info-row">
                                <span class="info-label">Address:</span>
                                <span class="info-value">{{ shop.address }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Google Maps Link:</span>
                                <span class="info-value">
                                    {% if shop.google_map_link %}
                                    <a href="{{ shop.google_map_link }}" target="_blank">{{ shop.google_map_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Social Media</h5>
                            <div class="info-row">
                                <span class="info-label">Facebook:</span>
                                <span class="info-value">
                                    {% if shop.facebook_link %}
                                    <a href="{{ shop.facebook_link }}" target="_blank">{{ shop.facebook_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">YouTube:</span>
                                <span class="info-value">
                                    {% if shop.youtube_link %}
                                    <a href="{{ shop.youtube_link }}" target="_blank">{{ shop.youtube_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Edit mode fields -->
                    <div class="form-fields">
                        <div class="form-section">
                            <h5>Company</h5>
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Company Name</label>
                                        {{ form.company_name }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Contact</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Primary Contact:</label>
                                        {{ form.contact_number1 }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Secondary Contact:</label>
                                        {{ form.contact_number2 }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">WhatsApp Contact:</label>
                                        {{ form.whatsapp_number }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Location</h5>
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Address:</label>
                                        {{ form.address }}
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Google Maps Link:</label>
                                        {{ form.google_map_link }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Social Media</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Facebook:</label>
                                        <div class="social-link-input">
                                            <i class="fab fa-facebook"></i>
                                            {{ form.facebook_link }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">YouTube:</label>
                                        <div class="social-link-input">
                                            <i class="fab fa-youtube"></i>
                                            {{ form.youtube_link }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end action-buttons" style="gap: 1rem;">
                        <button type="button" class="btn btn-outline-secondary" id="cancelEditBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Handle cover photo upload
    document.getElementById('id_cover_photo').addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            const preview = document.getElementById('cover-preview');
            const placeholder = document.getElementById('cover-placeholder');
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };
            
            reader.readAsDataURL(this.files[0]);
        }
    });

    // Handle remove cover photo
    const removeCoverBtn = document.getElementById('removeCoverBtn');
    const removeCoverInput = document.getElementById('removeCoverInput');

    if (removeCoverBtn) {
        removeCoverBtn.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent any default action
            e.stopPropagation(); // Stop event bubbling
            
            const fileInput = document.getElementById('id_cover_photo');
            const preview = document.getElementById('cover-preview');
            const placeholder = document.getElementById('cover-placeholder');
            
            // Clear the file input
            if (fileInput) {
                fileInput.value = '';
            }
            
            // Hide the preview image
            if (preview) {
                preview.src = '';
                preview.style.display = 'none';
            }
            
            // Show the placeholder
            if (placeholder) {
                placeholder.style.display = 'flex';
            }
            
            // Set the remove flag
            if (removeCoverInput) {
                removeCoverInput.value = '1';
            }
            
            // Hide the remove button
            removeCoverBtn.style.display = 'none';
            
            // Prevent form submission
            return false;
        });
    }

    // Handle edit mode
    const editShopBtn = document.getElementById('editShopBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const shopForm = document.getElementById('shopForm');
    
    // Function to toggle edit mode
    function toggleEditMode(enabled) {
        shopForm.classList.toggle('edit-mode', enabled);
        editShopBtn.style.display = enabled ? 'none' : 'inline-flex';
        const coverLabel = document.querySelector('.cover-upload');
        const removeBtn = document.getElementById('removeCoverBtn');
        
        if (enabled) {
            coverLabel.classList.add('editing');
            // Ensure recycle bin is visible in edit mode
            // Hide recycle bin in read-only mode
        } else {
            coverLabel.classList.remove('editing');
            // Hide recycle bin in read-only mode
        }
    }

    // Initialize form in read-only mode
    toggleEditMode(false);

    // Edit button click handler
    editShopBtn.addEventListener('click', function(e) {
        e.preventDefault();
        toggleEditMode(true);
    });

    // Cancel button click handler
    cancelEditBtn.addEventListener('click', function() {
        toggleEditMode(false);
        // Reset form to original values
        shopForm.reset();
        // Reset cover photo preview if changed
        const preview = document.getElementById('cover-preview');
        const placeholder = document.getElementById('cover-placeholder');
        if (preview && preview.getAttribute('data-original-src')) {
            preview.src = preview.getAttribute('data-original-src');
            preview.style.display = preview.getAttribute('data-original-src') ? 'block' : 'none';
            if (placeholder) {
                placeholder.style.display = preview.getAttribute('data-original-src') ? 'none' : 'flex';
            }
        }
    });

    // Store original cover photo state
    const preview = document.getElementById('cover-preview');
    if (preview) {
        preview.setAttribute('data-original-src', preview.src);
    }
</script>
{% endblock %} 
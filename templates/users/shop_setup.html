{% extends 'base.html' %}
{% load static %}

{% block title %}Shop Setup - Vehicle Ads{% endblock %}

{% block extra_css %}
<style>
    .cover-upload {
        position: relative;
        width: 100%;
        padding-top: 50%; /* 4:2 aspect ratio container */
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
    }

    .cover-upload .upload-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

    .cover-upload:hover .cover-overlay {
        opacity: 1;
    }

    .cover-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.2s;
    }

    .cover-upload input[type='file'] {
        opacity: 0;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .cover-upload img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
    }
    .form-section {
        margin-bottom: 2rem;
    }
    .form-section h5 {
        margin-bottom: 1rem;
        color: #333;
    }
    .social-link-input {
        position: relative;
    }
    .social-link-input i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
    }
    .social-link-input input {
        padding-left: 35px !important;
    }
    .remove-cover-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0,0,0,0.6);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s;
    }
    .cover-upload:hover .remove-cover-btn,
    .cover-upload.editing .remove-cover-btn {
        opacity: 1;
    }
    .form-fields {
        display: none;
    }
    .edit-mode .form-fields {
        display: block;
    }
    .read-only-text {
        display: block;
    }
    .edit-mode .read-only-text {
        display: none;
    }
    .form-label {
        font-weight: 500;
        color: #333;
    }
    .action-buttons {
        display: none !important;
    }
    .edit-mode .action-buttons {
        display: flex !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5" style="max-width: 1100px;">
    <div class="row">
        <div class="col-md-3 mb-4">
            <h5 class="fw-bold mb-4">Account Settings</h5>
            <div class="d-flex flex-column gap-2">
                <a href="{% url 'users:profile' %}" class="btn btn-light">Profile</a>
                <button class="btn btn-light" disabled>Shop</button>
            </div>
        </div>
        <div class="col-md-9">
            <div class="card p-4" style="border-radius: 1rem;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold mb-0">Shop Setup</h2>
                    <a href="#" class="edit-profile-btn" id="editShopBtn">
                        <i class="fas fa-pen"></i>
                        <span>Edit Shop</span>
                    </a>
                </div>
                <hr>
                <form method="post" enctype="multipart/form-data" id="shopForm">
                    {% csrf_token %}
                    <!-- Cover Photo -->
                    <div class="form-section">
                        <h5>Cover Page</h5>
                        <label class="cover-upload" for="id_cover_photo">
                            {% if shop and shop.cover_photo %}
                                <img src="{{ shop.cover_photo.url }}" alt="Cover Photo" id="cover-preview">
                            {% else %}
                                <div class="upload-content" id="cover-placeholder">
                                    <i class="fas fa-plus-circle mb-2" style="font-size: 3rem; color: #cbd5e1;"></i>
                                    <p class="text-muted mb-0">Click to upload cover photo</p>
                                </div>
                                <img src="" alt="Cover Photo" id="cover-preview" style="display: none;">
                            {% endif %}
                            <div class="cover-overlay">
                                <i class="fas fa-camera" style="font-size: 2rem; color: white;"></i>
                            </div>
                            {{ form.cover_photo }}
                            <input type="hidden" name="remove_cover" id="removeCoverInput" value="0">
                            <button type="button" class="remove-cover-btn" id="removeCoverBtn" title="Remove cover photo">
                                <i class="fas fa-trash"></i>
                            </button>
                        </label>
                    </div>

                    <!-- Read-only display -->
                    <div class="read-only-text">
                        <div class="form-section">
                            <h5>Company</h5>
                            <div class="info-row">
                                <span class="info-label">Company Name:</span>
                                <span class="info-value">{{ shop.company_name }}</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Contact</h5>
                            <div class="info-row">
                                <span class="info-label">Primary Contact:</span>
                                <span class="info-value">{{ shop.contact_number1 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Secondary Contact:</span>
                                <span class="info-value">{{ shop.contact_number2 }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">WhatsApp Contact:</span>
                                <span class="info-value">{{ shop.whatsapp_number }}</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Location</h5>
                            <div class="info-row">
                                <span class="info-label">Address:</span>
                                <span class="info-value">{{ shop.address }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Google Maps Link:</span>
                                <span class="info-value">
                                    {% if shop.google_map_link %}
                                    <a href="{{ shop.google_map_link }}" target="_blank">{{ shop.google_map_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Social Media</h5>
                            <div class="info-row">
                                <span class="info-label">Facebook:</span>
                                <span class="info-value">
                                    {% if shop.facebook_link %}
                                    <a href="{{ shop.facebook_link }}" target="_blank">{{ shop.facebook_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">YouTube:</span>
                                <span class="info-value">
                                    {% if shop.youtube_link %}
                                    <a href="{{ shop.youtube_link }}" target="_blank">{{ shop.youtube_link }}</a>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Edit mode fields -->
                    <div class="form-fields">
                        <div class="form-section">
                            <h5>Company</h5>
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Company Name</label>
                                        {{ form.company_name }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Contact</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Primary Contact:</label>
                                        {{ form.contact_number1 }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Secondary Contact:</label>
                                        {{ form.contact_number2 }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">WhatsApp Contact:</label>
                                        {{ form.whatsapp_number }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Location</h5>
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Address:</label>
                                        {{ form.address }}
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label class="form-label">Google Maps Link:</label>
                                        {{ form.google_map_link }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h5>Social Media</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Facebook:</label>
                                        <div class="social-link-input">
                                            <i class="fab fa-facebook"></i>
                                            {{ form.facebook_link }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">YouTube:</label>
                                        <div class="social-link-input">
                                            <i class="fab fa-youtube"></i>
                                            {{ form.youtube_link }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end action-buttons" style="gap: 1rem;">
                        <button type="button" class="btn btn-outline-secondary" id="cancelEditBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Handle cover photo upload
    document.getElementById('id_cover_photo').addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            const preview = document.getElementById('cover-preview');
            const placeholder = document.getElementById('cover-placeholder');
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
            };
            
            reader.readAsDataURL(this.files[0]);
        }
    });

    // Handle remove cover photo
    const removeCoverBtn = document.getElementById('removeCoverBtn');
    const removeCoverInput = document.getElementById('removeCoverInput');

    removeCoverBtn.addEventListener('click', function() {
        const fileInput = document.getElementById('id_cover_photo');
        const preview = document.getElementById('cover-preview');
        const placeholder = document.getElementById('cover-placeholder');
        fileInput.value = '';
        if (preview) {
            preview.src = '';
            preview.style.display = 'none';
        }
        if (placeholder) {
            placeholder.style.display = 'flex';
        }
        removeCoverInput.value = '1';
    });

    // Handle edit mode
    const editShopBtn = document.getElementById('editShopBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const shopForm = document.getElementById('shopForm');
    
    // Function to toggle edit mode
    function toggleEditMode(enabled) {
        shopForm.classList.toggle('edit-mode', enabled);
        editShopBtn.style.display = enabled ? 'none' : 'inline-flex';
        const coverLabel = document.querySelector('.cover-upload');
        if (enabled) {
            coverLabel.classList.add('editing');
        } else {
            coverLabel.classList.remove('editing');
        }
    }

    // Initialize form in read-only mode
    toggleEditMode(false);

    // Edit button click handler
    editShopBtn.addEventListener('click', function(e) {
        e.preventDefault();
        toggleEditMode(true);
    });

    // Cancel button click handler
    cancelEditBtn.addEventListener('click', function() {
        toggleEditMode(false);
        // Reset form to original values
        shopForm.reset();
        // Reset cover photo preview if changed
        const preview = document.getElementById('cover-preview');
        const placeholder = document.getElementById('cover-placeholder');
        if (preview && preview.getAttribute('data-original-src')) {
            preview.src = preview.getAttribute('data-original-src');
            preview.style.display = preview.getAttribute('data-original-src') ? 'block' : 'none';
            if (placeholder) {
                placeholder.style.display = preview.getAttribute('data-original-src') ? 'none' : 'flex';
            }
        }
    });

    // Store original cover photo state
    const preview = document.getElementById('cover-preview');
    if (preview) {
        preview.setAttribute('data-original-src', preview.src);
    }
</script>
{% endblock %} 